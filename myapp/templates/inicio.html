{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Estás Sola</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="{% static 'css/inicio.css' %}">
    <link rel="icon" href="{% static 'img/logoalcaldia.ico' %}" type="image/x-icon">

</head>

<body>

    <div class="desktop-1">
        {% for boton in botones %}
        <div class="button-group">
            <div class="icon-button-container">
                <div class="icon-container">
                    <img src="{% static boton.imgBoton %}" alt="{{ boton.nombre }}" class="icon" />
                </div>
                <form method="POST" id="form-{{ boton.nombre }}" class="form-boton">
                    {% csrf_token %}
                    <!-- Campo oculto para enviar el nombre del botón -->
                    <input type="hidden" name="boton" value="{{ boton.nombre }}">
                    <button class="button" type="button" onclick="redirigirWhatsApp('{{ boton.numero }}', event)">
                        <span class="button2">{{ boton.nombre }}</span>
                    </button>
                </form>
            </div>
            <div class="description">
                {% if boton.nombre == "Linea púrpura" %}
                (Línea de acompañamiento psicosocial y jurídico)
                {% elif boton.nombre == "Patrulla púrpura" %}
                (Cuadrante de la Policía Nacional especializado en violencia basada en género.)
                {% elif boton.nombre == "Taxi púrpura" %}
                (Siéntete segura viajando en nuestros taxis<br>intermunicipales, especializados en transportar mujeres.)
                {% else %}
                {{ boton.descripcion }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        // Función que envía el formulario utilizando AJAX y luego redirige a WhatsApp
        function redirigirWhatsApp(numero, event) {
            event.preventDefault(); // Prevenir el comportamiento predeterminado del botón (enviar el formulario)

            // Obtener el formulario correspondiente al botón
            const form = event.target.closest('form');
            const formData = new FormData(form);

            // Enviar el formulario usando AJAX
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => {
                if (response.ok) {
                    // Después de que el formulario se haya enviado correctamente, redirigir a WhatsApp
                    window.location.href = `https://wa.me/+57${numero}`;
                } else {
                    console.error('Error al enviar el formulario');
                }
            })
            .catch(error => {
                console.error('Error al enviar el formulario:', error);
            });
        }
    </script>

</body>

</html>
